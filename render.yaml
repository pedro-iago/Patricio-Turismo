services:
  - type: web
    name: patricio-turismo-web
    plan: free 
    envVars:
      - key: JAVA_VERSION
        value: 17

    buildCommand: |
      echo "Iniciando build do Monorepo..."
      cd frontend
      npm install
      npm run build
      cd ..
      mkdir -p backend/src/main/resources/static

      # --- Copiando arquivos do Frontend ---
      echo "Copiando arquivos do Frontend..."
      cp -r frontend/dist/* backend/src/main/resources/static/

      cd backend
      echo "Dando permissão de execução ao mvnw..."
      chmod +x mvnw

      echo "Configurando JAVA_HOME..."
      export JAVA_HOME=$(dirname $(dirname $(readlink -f $(which java))))
      export PATH=$JAVA_HOME/bin:$PATH

      echo "Construindo o Backend (Spring)..."
      ./mvnw clean package -DskipTests

    startCommand: java -jar backend/target/crud-0.0.1-SNAPSHOT.jar

databases:
  - name: patricio-db
    plan: free
